name: ä½¿ç”¨æŠ±è„¸SDKåˆ›å»ºPlayer

on:
  workflow_dispatch:
    inputs:
      Token:
        description: 'HuggingFace çš„ Access Tokenï¼Œéœ€å…·æœ‰å†™å…¥ Spaces æƒé™'
        required: true
        default: ''
      UserID:
        description: 'HuggingFace ç”¨æˆ·å'
        required: true
        default: ''
      SpaceName:
        description: 'Spaces åç§°ï¼ˆå¯é€‰ï¼Œä¸å¡«é»˜è®¤ä¸º Playerï¼‰'
        required: false
        default: 'Player'

jobs:
  deploy:
    runs-on: ubuntu-latest
    if: github.event.repository.owner.id == github.event.sender.id

    steps:
      - name: Checkout ä»“åº“ä»£ç 
        uses: actions/checkout@v3

      - name: éšè—æ•æ„Ÿè¾“å…¥
        uses: levibostian/action-hide-sensitive-inputs@v1

      - name: è®¾ç½® Python ç¯å¢ƒ
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      - name: å®‰è£…ä¾èµ–
        run: |
          python -m pip install --upgrade pip
          pip install huggingface_hub

      - name:
        env:
          HF_TOKEN: ${{ github.event.inputs.Token }}
          HF_USER: ${{ github.event.inputs.UserID }}
          HF_SPACE: ${{ github.event.inputs.SpaceName }}
        run: |
          python <<EOF
          from huggingface_hub import HfApi
          import os
          import subprocess

          token = os.environ["HF_TOKEN"]
          user = os.environ["HF_USER"]
          space_name = os.environ.get("HF_SPACE", "Player")
          full_space_id = f"{user}/{space_name}"

          api = HfApi(token=token)

          print(f"ğŸš€ æ­£åœ¨å¼ºåˆ¶åˆ›å»º Spaceï¼š{full_space_id}")
          api.create_repo(
              repo_id=full_space_id,
              repo_type="space",
              space_sdk="docker",
              private=False,
              exist_ok=True
          )

          # åˆå§‹åŒ– Git å¹¶å¼ºæ¨ä»£ç 
          subprocess.run(["git", "init"])
          subprocess.run(["git", "config", "--global", "user.name", "github-actions"])
          subprocess.run(["git", "config", "--global", "user.email", "actions@github.com"])
          subprocess.run(["git", "remote", "add", "origin", f"https://{token}@huggingface.co/spaces/{full_space_id}"])
          subprocess.run(["git", "add", "."])
          subprocess.run(["git", "commit", "-m", "ğŸ¤– è‡ªåŠ¨éƒ¨ç½² Player é¡¹ç›®åˆ° Hugging Face"])
          subprocess.run(["git", "push", "--force", "origin", "HEAD:main"])
          EOF
